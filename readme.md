# Итоговый проект по курсу "Рекомендательные системы"

### Задача; Предсказать будущие покупки пользователей
Целевая метрика - MAP@5 > 20%.

Для решения задачи будем использовать двухуровневую рекомендательную систему:
- Модель 1го уровня  которая выдет список рекомендаций для каждого пользователя.
- Модель второго уровня ранжирует список и выдет топ5.

### Лучшее решение по метрике MAP@5:
1. ItemItemRecommender со взвешиванием BM25 - 
2. ALS со взвешиванием tfidf - 
3. ALS со взвешиванием BM25 - 

##### Модель lvl 1
На 1м уровне в лучшем решении использована модель ItemItemRecommender обученная на взвешенной bm25 матрице, которая выдет список из 500
рекомендаций для каждого пользователя. Пробовал также комбинировать результаты работы моделей на 1м уровне - итоговый результат оказался хуже.

##### Модель lvl 2
На 2м уровне в лучшем решении использована модель CatBoostClassifier c eval_metric "BrierScore". Данная модель обучается на результатах работы 
модели lvl 1 с добавлением фичей и выдает 5 рекомендаций для каждого пользователя. Модель LightGBM показала результаты на ~3% хуже, но время
ее обучения существенно меньше - 6 секунд против 12 минут catBoost.

##### Описание
1. Код решения содержится в файле final_project.ipynb
2. В папке best_rec_lib содержатся файлы:
	- metrics.py - метрики
	- utils.py - обрабока данных, создание фичей
	- recommenders.py - класс рекомендера с моделями
4. В файле predictions.csv находятся итоговые предсказания.

##### Примечание
В рекомендациях на lvl 2 важно сделать проверку на уникальность элементов, иначе метрика MAP@5 будет зашкаливать, но по факту это из-за множества дублей.
Причем сделать это надо не через set(), т.к. в этом случае нарушится порядок элементов рекомендации, которого добивались ранжируя данные моделью второго уровня.
